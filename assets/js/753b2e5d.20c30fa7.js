"use strict";(self.webpackChunkgp_doc_github_io=self.webpackChunkgp_doc_github_io||[]).push([[2756],{7331:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>d,default:()=>o,frontMatter:()=>i,metadata:()=>l,toc:()=>a});var s=n(6070),t=n(5710);const i={sidebar_position:5},d="\u8ba2\u9605(subscription)",l={id:"tutorial/subscription",title:"\u8ba2\u9605(subscription)",description:"\u5feb\u901f\u6d4f\u89c8\u8ba2\u9605\u793a\u4f8b",source:"@site/docs/tutorial/subscription.md",sourceDirName:"tutorial",slug:"/tutorial/subscription",permalink:"/docs/tutorial/subscription",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_position:5},sidebar:"tutorialSidebar",previous:{title:"\u53d8\u66f4(mutation)",permalink:"/docs/tutorial/mutation"},next:{title:"GPI(GraphQL API)",permalink:"/docs/tutorial/graphql-api"}},c={},a=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"Altair",id:"altair",level:2},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"\u57fa\u672c\u8ba2\u9605",id:"\u57fa\u672c\u8ba2\u9605",level:2},{value:"<strong>\u8ba2\u9605\u63a5\u53e3</strong>",id:"\u8ba2\u9605\u63a5\u53e3",level:3},{value:"\u8ba2\u9605\u4e0e\u53d8\u66f4",id:"\u8ba2\u9605\u4e0e\u53d8\u66f4",level:3},{value:"<strong>\u8ba2\u9605\u53c2\u6570</strong>",id:"\u8ba2\u9605\u53c2\u6570",level:2}];function h(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",hr:"hr",img:"img",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.h1,{id:"\u8ba2\u9605subscription",children:"\u8ba2\u9605(subscription)"}),"\n",(0,s.jsx)(r.p,{children:"\u5feb\u901f\u6d4f\u89c8\u8ba2\u9605\u793a\u4f8b"}),"\n",(0,s.jsx)(r.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,s.jsx)(r.p,{children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-gradle",children:"repositories {\r\n    mavenCentral()\r\n    // highlight-start\r\n    jcenter()\r\n    // highlight-end\r\n}\r\n\r\ndependencies {\r\n    // highlight-start\r\n    implementation 'io.graphoenix:graphoenix-rabbitmq:0.0.1-SNAPSHOT'\r\n    // highlight-end\r\n    // ...\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"altair",children:"Altair"}),"\n",(0,s.jsxs)(r.p,{children:["\u4f7f\u7528 ",(0,s.jsx)(r.a,{href:"https://altairgraphql.dev/",children:"Altair GraphQL Client"})," \u8fdb\u884c\u8ba2\u9605\u6d4b\u8bd5\r\n",(0,s.jsx)(r.img,{src:"https://altairgraphql.dev/assets/img/app-shot.png",alt:"Altair",title:"Altair"})]}),"\n",(0,s.jsx)(r.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["\u6253\u5f00 Request Handlers\r\n",(0,s.jsx)(r.img,{alt:"Request Handlers",src:n(9024).A+"",title:"Request Handlers",width:"868",height:"608"})]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["\n",(0,s.jsxs)(r.p,{children:["\u914d\u7f6e\u8ba2\u9605\u5730\u5740, \u9009\u62e9\u8ba2\u9605\u7c7b\u578b\u4e3a SSE\r\n",(0,s.jsx)(r.img,{alt:"Settings",src:n(2657).A+"",title:"Settings",width:"1036",height:"1280"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u57fa\u672c\u8ba2\u9605",children:"\u57fa\u672c\u8ba2\u9605"}),"\n",(0,s.jsx)(r.h3,{id:"\u8ba2\u9605\u63a5\u53e3",children:(0,s.jsx)(r.strong,{children:"\u8ba2\u9605\u63a5\u53e3"})}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"\u63a5\u53e3\u540d"}),(0,s.jsx)(r.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(r.th,{children:"\u53c2\u6570"}),(0,s.jsx)(r.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(r.th,{children:"\u793a\u4f8b (Type=User)"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"(type)"}),(0,s.jsx)(r.td,{children:"(Type)"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"#%E8%AE%A2%E9%98%85%E5%8F%82%E6%95%B0",children:"(Type)SubscriptionArguments"})}),(0,s.jsx)(r.td,{children:"\u8ba2\u9605\u5355\u6761"}),(0,s.jsx)(r.td,{children:"user"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"(type)List"}),(0,s.jsx)(r.td,{children:"[(Type)]"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"#%E8%AE%A2%E9%98%85%E5%8F%82%E6%95%B0",children:"(Type)ListSubscriptionArguments"})}),(0,s.jsx)(r.td,{children:"\u8ba2\u9605\u5217\u8868"}),(0,s.jsx)(r.td,{children:"userList"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"(type)Connection"}),(0,s.jsx)(r.td,{children:"[(Type)]"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"#%E8%AE%A2%E9%98%85%E5%8F%82%E6%95%B0",children:"(Type)ConnectionSubscriptionArguments"})}),(0,s.jsx)(r.td,{children:"\u8ba2\u9605\u5206\u9875"}),(0,s.jsx)(r.td,{children:"userConnection"})]})]})]}),"\n",(0,s.jsx)(r.h3,{id:"\u8ba2\u9605\u4e0e\u53d8\u66f4",children:"\u8ba2\u9605\u4e0e\u53d8\u66f4"}),"\n",(0,s.jsx)(r.p,{children:"\u53d8\u66f4\u8bf7\u6c42\u4f1a\u628a\u53d8\u66f4\u5185\u5bb9\u53d1\u9001\u5230\u6d88\u606f\u961f\u5217(MQ)\u4e2d, \u8ba2\u9605\u4f1a\u6839\u636e\u7c7b\u578b\u548c\u5b57\u6bb5\u8ba2\u9605 MQ \u4e2d\u5bf9\u5e94\u7684\u9891\u9053, \u5728\u5339\u914d\u5230\u7b26\u5408\u6761\u4ef6\u7684\u53d8\u66f4\u5185\u5bb9\u540e\u901a\u8fc7 SSE \u63a8\u9001\u65b0\u7684\u6570\u636e"}),"\n",(0,s.jsx)(r.mermaid,{value:'flowchart LR\r\n    subgraph \u53d8\u66f4\r\n        request2[\u53d8\u66f4\u8bf7\u6c42]\r\n        mutation["// mutation.graphql\r\n        mutation {\r\n        &emsp;product(price: &quot;1000.00&quot;, where: {name: &quot;Laptop&quot}) {\r\n        &emsp;&emsp;id\r\n        &emsp;}\r\n        }"]\r\n        request2 --\x3e mutation\r\n    end\r\n    mutation -- \u63d0\u4ea4 --\x3e http\r\n    subgraph Graphoenix\r\n        mq[(Message Queue)]\r\n        types["// types.graphql\r\n        type Product {\r\n        &emsp;id: ID!\r\n        &emsp;name: String!\r\n        &emsp;price: Float!\r\n        }"]\r\n        schema["// schema.graphql\r\n        schema {\r\n        &emsp;subscription: Subscription\r\n        }\r\n        type Subscription {\r\n        &emsp;product: Product\r\n        &emsp;productList: [Product]\r\n        &emsp;productConnection: ProductConnection\r\n        }"]\r\n        types -- \u6784\u5efaSchema --\x3e schema -- \u6784\u5efa\u670d\u52a1 --\x3e http --\x3e mq --\x3e sse\r\n    end\r\n    sse -- \u63a8\u9001 --\x3e response\r\n    subgraph \u8ba2\u9605\r\n        request1[\u8ba2\u9605\u8bf7\u6c42]\r\n        subscription["// subscription.graphql\r\n        subscription {\r\n        &emsp;product {\r\n        &emsp;&emsp;name\r\n        &emsp;&emsp;price\r\n        &emsp;}\r\n        }"]\r\n        response["// response.json\r\n        {\r\n        &emsp;&quot;product&quot;: {\r\n        &emsp;&emsp;&quot;name&quot;: &quot;Laptop&quot;\r\n        &emsp;&emsp;&quot;price&quot;: 1000.00\r\n        &emsp;}\r\n        }"]\r\n        response --\x3e request1 --\x3e subscription\r\n    end\r\n    subscription -- \u6ce8\u518c\u8ba2\u9605 --\x3e http\r\n    style types text-align:left\r\n    style schema text-align:left\r\n    style subscription text-align:left\r\n    style mutation text-align:left\r\n    style response text-align:left'}),"\n",(0,s.jsxs)(r.p,{children:["\u4f7f\u7528\u4e0e\u5b57\u6bb5\u540c\u540d\u7684\u53c2\u6570\u6784\u9020\u67e5\u8be2\u6761\u4ef6, ",(0,s.jsx)(r.a,{href:"/docs/guide/types#operator",children:(0,s.jsx)(r.code,{children:"opr"})})," \u4f5c\u4e3a\u67e5\u8be2\u7b26\u53f7, ",(0,s.jsx)(r.a,{href:"/docs/guide/types#scalarenumexpression",children:(0,s.jsx)(r.code,{children:"val"})})," \u4f5c\u4e3a\u67e5\u8be2\u5185\u5bb9, \u5982\u679c\u67e5\u8be2\u5185\u5bb9\u4e3a\u6570\u7ec4\u5219\u4f7f\u7528 ",(0,s.jsx)(r.a,{href:"/docs/guide/types#scalarenumexpression",children:(0,s.jsx)(r.code,{children:"arr"})})]}),"\n",(0,s.jsx)(r.p,{children:"\u4f8b: \u8ba2\u9605\u6240\u6709\u7c7b\u578b\u662f VIP \u7684\u7528\u6237"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-graphql",children:"subscription {\r\n  userList(userType: { val: VIP }) {\r\n    name\r\n    email\r\n    userType\r\n  }\r\n}\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",children:'{\r\n  "data": {\r\n    "userList": [\r\n      {\r\n        "name": "Alice",\r\n        "email": "alice@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Charlie",\r\n        "email": "charlie@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Edward",\r\n        "email": "edward@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "George",\r\n        "email": "george@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Ian",\r\n        "email": "ian@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Kyle",\r\n        "email": "kyle@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Mike",\r\n        "email": "mike@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Oliver",\r\n        "email": "oliver@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Quentin",\r\n        "email": "quentin@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Steve",\r\n        "email": "steve@example.com",\r\n        "userType": "VIP"\r\n      }\r\n    ]\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"\u901a\u8fc7\u53d8\u66f4\u65b0\u589e VIP \u7528\u6237 Uma"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-graphql",children:'mutation {\r\n  user(\r\n    name: "Uma"\r\n    email: "uma@example.com"\r\n    userType: VIP\r\n    phoneNumbers: ["13918124629", "18536492446"]\r\n  ) {\r\n    id\r\n    name\r\n    email\r\n    phoneNumbers\r\n    userType\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.p,{children:"\u8ba2\u9605\u6536\u5230\u65b0\u7684\u63a8\u9001\u6570\u636e"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-graphql",children:'{\r\n  "data": {\r\n    "userList": [\r\n      {\r\n        "name": "Alice",\r\n        "email": "alice@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Charlie",\r\n        "email": "charlie@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Edward",\r\n        "email": "edward@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "George",\r\n        "email": "george@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Ian",\r\n        "email": "ian@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Kyle",\r\n        "email": "kyle@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Mike",\r\n        "email": "mike@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Oliver",\r\n        "email": "oliver@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Quentin",\r\n        "email": "quentin@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      {\r\n        "name": "Steve",\r\n        "email": "steve@example.com",\r\n        "userType": "VIP"\r\n      },\r\n      // highlight-start\r\n      {\r\n        "name": "Uma",\r\n        "email": "uma@example.com",\r\n        "userType": "VIP"\r\n      }\r\n      // highlight-end\r\n    ]\r\n  }\r\n}\n'})}),"\n",(0,s.jsx)(r.hr,{}),"\n",(0,s.jsx)(r.h2,{id:"\u8ba2\u9605\u53c2\u6570",children:(0,s.jsx)(r.strong,{children:"\u8ba2\u9605\u53c2\u6570"})}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"\u53c2\u6570\u540d"}),(0,s.jsx)(r.th,{children:"\u7c7b\u578b"}),(0,s.jsx)(r.th,{children:"\u9ed8\u8ba4\u503c"}),(0,s.jsx)(r.th,{children:"\u8bf4\u660e"}),(0,s.jsx)(r.th,{children:"SQL \u793a\u4f8b (x=10 y=5)"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"(field)"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"/docs/guide/types#scalarenumexpression",children:"(Scalar/Enum/Object)Expression"})}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u6761\u4ef6\u5b57\u6bb5"}),(0,s.jsxs)(r.td,{children:["SELECT id FROM t WHERE ",(0,s.jsx)(r.strong,{children:"t.field"})," = 'xyz'"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"first"}),(0,s.jsx)(r.td,{children:"Int"}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u83b7\u53d6\u524d x \u6761"}),(0,s.jsx)(r.td,{children:"SELECT id FROM t LIMIT 10"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"last"}),(0,s.jsx)(r.td,{children:"Int"}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u83b7\u53d6\u540e x \u6761"}),(0,s.jsx)(r.td,{children:"SELECT id FROM t ORDER BY id DESC LIMIT 10"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"offset"}),(0,s.jsx)(r.td,{children:"Int"}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u8df3\u8fc7 y \u6761"}),(0,s.jsx)(r.td,{children:"SELECT id FROM t LIMIT 5, 10"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"cond"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"/docs/guide/types#conditional",children:"Conditional"})}),(0,s.jsx)(r.td,{children:"AND"}),(0,s.jsx)(r.td,{children:"\u53c2\u6570\u5185\u6761\u4ef6\u7684\u7ec4\u5408\u5173\u7cfb"}),(0,s.jsxs)(r.td,{children:["WHERE t.field = 'xyz' ",(0,s.jsx)(r.strong,{children:"AND"})," t.field <> 'abc'"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"not"}),(0,s.jsx)(r.td,{children:"Boolean"}),(0,s.jsx)(r.td,{children:"false"}),(0,s.jsx)(r.td,{children:"\u6761\u4ef6\u53d6\u975e"}),(0,s.jsxs)(r.td,{children:["WHERE ",(0,s.jsx)(r.strong,{children:"NOT"})," (t.field = 'xyz' AND t.field <> 'abc')"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"exs"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"/docs/guide/types#objectexpression",children:"[(Object)Expression]"})}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u540c\u4e00\u5b57\u6bb5\u591a\u6b21\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6\u65f6\u53ef\u4f7f\u7528\u6b64\u53c2\u6570"}),(0,s.jsxs)(r.td,{children:["WHERE ",(0,s.jsx)(r.strong,{children:"("})," t.field = 'xyz' AND t.field <> 'abc' ",(0,s.jsx)(r.strong,{children:")"})]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"orderBy"}),(0,s.jsx)(r.td,{children:(0,s.jsx)(r.a,{href:"/docs/guide/types#objectorderby",children:"[(Object)OrderBy]"})}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u6392\u5e8f\u5b57\u6bb5"}),(0,s.jsxs)(r.td,{children:["SELECT id FROM t ",(0,s.jsx)(r.strong,{children:"ORDER BY"})," t.field"]})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:"groupBy"}),(0,s.jsx)(r.td,{children:"[String]"}),(0,s.jsx)(r.td,{children:"\u65e0"}),(0,s.jsx)(r.td,{children:"\u5206\u7ec4\u5b57\u6bb5"}),(0,s.jsxs)(r.td,{children:["SELECT id FROM t ",(0,s.jsx)(r.strong,{children:"GROUP BY"})," t.field"]})]})]})]})]})}function o(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},9024:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/requestHandlers-583b044d7581192243bbd66dd958fcd6.png"},2657:(e,r,n)=>{n.d(r,{A:()=>s});const s=n.p+"assets/images/settings-6ad942e7d57d34d4aa1bc3928e5e04c1.png"},5710:(e,r,n)=>{n.d(r,{R:()=>d,x:()=>l});var s=n(758);const t={},i=s.createContext(t);function d(e){const r=s.useContext(i);return s.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(i.Provider,{value:r},e.children)}}}]);
"use strict";(self.webpackChunkgp_doc_github_io=self.webpackChunkgp_doc_github_io||[]).push([[6752],{1966:(n,t,e)=>{e.r(t),e.d(t,{assets:()=>s,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>c,toc:()=>l});var r=e(6070),i=e(5710);const o={sidebar_position:2},a="\u5207\u9762(interceptor)",c={id:"jakarta-ee/interceptor",title:"\u5207\u9762(interceptor)",description:"\u5207\u9762\u7f16\u7a0b\uff08Aspect-Oriented Programming, AOP\uff09\u662f\u4e00\u79cd\u7f16\u7a0b\u8303\u5f0f, \u5b83\u901a\u8fc7\u5c06\u6a2a\u5207\u5173\u6ce8\u70b9\uff08cross-cutting concerns\uff09\u4e0e\u4e1a\u52a1\u903b\u8f91\u5206\u79bb, \u6765\u589e\u5f3a\u4ee3\u7801\u7684\u6a21\u5757\u5316. \u5728\u4f01\u4e1a\u7ea7 Java \u5f00\u53d1\u4e2d, AOP \u901a\u5e38\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55, \u5b89\u5168\u6027, \u4e8b\u52a1\u7ba1\u7406\u7b49\u65b9\u9762",source:"@site/docs/jakarta-ee/interceptor.md",sourceDirName:"jakarta-ee",slug:"/jakarta-ee/interceptor",permalink:"/docs/jakarta-ee/interceptor",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"\u4f9d\u8d56\u6ce8\u5165(inject)",permalink:"/docs/jakarta-ee/inject"},next:{title:"\u6307\u5357",permalink:"/docs/category/\u6307\u5357"}},s={},l=[{value:"\u5b89\u88c5",id:"\u5b89\u88c5",level:2},{value:"\u65b9\u6cd5\u5207\u9762",id:"\u65b9\u6cd5\u5207\u9762",level:2},{value:"\u5b9a\u4e49\u65b9\u6cd5\u6ce8\u89e3",id:"\u5b9a\u4e49\u65b9\u6cd5\u6ce8\u89e3",level:3},{value:"\u5b9e\u73b0\u65b9\u6cd5\u5207\u9762",id:"\u5b9e\u73b0\u65b9\u6cd5\u5207\u9762",level:3},{value:"\u6807\u8bb0\u76ee\u6807\u65b9\u6cd5",id:"\u6807\u8bb0\u76ee\u6807\u65b9\u6cd5",level:3},{value:"\u6784\u9020\u5668\u5207\u9762",id:"\u6784\u9020\u5668\u5207\u9762",level:2},{value:"\u5b9a\u4e49\u6784\u9020\u5668\u6ce8\u89e3",id:"\u5b9a\u4e49\u6784\u9020\u5668\u6ce8\u89e3",level:3},{value:"\u5b9e\u73b0\u6784\u9020\u5668\u5207\u9762",id:"\u5b9e\u73b0\u6784\u9020\u5668\u5207\u9762",level:3},{value:"\u6807\u8bb0\u76ee\u6807\u6784\u9020\u5668",id:"\u6807\u8bb0\u76ee\u6807\u6784\u9020\u5668",level:3},{value:"\u6ce8\u518c\u5207\u9762",id:"\u6ce8\u518c\u5207\u9762",level:2},{value:"<strong>\u5207\u9762 API</strong>",id:"\u5207\u9762-api",level:2},{value:"InvocationContext",id:"invocationcontext",level:3},{value:"<strong>\u6ce8\u89e3\u8bf4\u660e</strong>",id:"\u6ce8\u89e3\u8bf4\u660e",level:2},{value:"Interceptor",id:"interceptor",level:3}];function d(n){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.h1,{id:"\u5207\u9762interceptor",children:"\u5207\u9762(interceptor)"}),"\n",(0,r.jsx)(t.p,{children:"\u5207\u9762\u7f16\u7a0b\uff08Aspect-Oriented Programming, AOP\uff09\u662f\u4e00\u79cd\u7f16\u7a0b\u8303\u5f0f, \u5b83\u901a\u8fc7\u5c06\u6a2a\u5207\u5173\u6ce8\u70b9\uff08cross-cutting concerns\uff09\u4e0e\u4e1a\u52a1\u903b\u8f91\u5206\u79bb, \u6765\u589e\u5f3a\u4ee3\u7801\u7684\u6a21\u5757\u5316. \u5728\u4f01\u4e1a\u7ea7 Java \u5f00\u53d1\u4e2d, AOP \u901a\u5e38\u7528\u4e8e\u65e5\u5fd7\u8bb0\u5f55, \u5b89\u5168\u6027, \u4e8b\u52a1\u7ba1\u7406\u7b49\u65b9\u9762"}),"\n",(0,r.jsx)(t.p,{children:"\u4ee5\u4e0b\u662f\u51e0\u79cd\u4e3b\u6d41\u7684 AOP \u6280\u672f\u53ca\u5176\u5b9e\u73b0\u5f62\u5f0f:"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u6846\u67b6"}),(0,r.jsx)(t.th,{children:"\u7c7b\u578b"}),(0,r.jsx)(t.th,{children:"\u539f\u7406"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Spring AOP"}),(0,r.jsx)(t.td,{children:"\u8fd0\u884c\u65f6"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.strong,{children:"JDK \u52a8\u6001\u4ee3\u7406"}),": \u9002\u7528\u4e8e\u63a5\u53e3\u4ee3\u7406. \u901a\u8fc7\u521b\u5efa\u5b9e\u73b0\u4e86\u76ee\u6807\u63a5\u53e3\u7684\u4ee3\u7406\u5bf9\u8c61\u6765\u62e6\u622a\u65b9\u6cd5\u8c03\u7528",(0,r.jsx)("br",{}),(0,r.jsx)(t.strong,{children:"CGLIB \u4ee3\u7406"}),": \u9002\u7528\u4e8e\u7c7b\u4ee3\u7406. \u901a\u8fc7\u521b\u5efa\u76ee\u6807\u7c7b\u7684\u5b50\u7c7b\u6765\u62e6\u622a\u65b9\u6cd5\u8c03\u7528"]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"AspectJ"}),(0,r.jsx)(t.td,{children:"\u7f16\u8bd1\u65f6/\u52a0\u8f7d\u65f6/\u8fd0\u884c\u65f6"}),(0,r.jsxs)(t.td,{children:[(0,r.jsx)(t.strong,{children:"\u7f16\u8bd1\u65f6\u7ec7\u5165"}),"(Compile-Time Weaving): \u5728\u6e90\u4ee3\u7801\u7f16\u8bd1\u4e3a\u5b57\u8282\u7801\u65f6, \u76f4\u63a5\u5c06\u5207\u9762\u4ee3\u7801\u7ec7\u5165\u5230\u5b57\u8282\u7801\u4e2d. \u8fd9\u9700\u8981\u4f7f\u7528 AspectJ \u63d0\u4f9b\u7684\u7f16\u8bd1\u5668 ajc, \u6216\u8005\u901a\u8fc7\u5c06 AspectJ \u96c6\u6210\u5230\u6784\u5efa\u5de5\u5177(\u5982 Maven \u6216 Gradle)\u4e2d.",(0,r.jsx)("br",{}),(0,r.jsx)(t.strong,{children:"\u540e\u7f16\u8bd1\u65f6\u7ec7\u5165"}),"(Post-Compile Weaving):\u4e5f\u79f0\u4e3a\u4e8c\u8fdb\u5236\u7ec7\u5165(Binary Weaving), \u662f\u5728\u5df2\u7ecf\u7f16\u8bd1\u597d\u7684\u5b57\u8282\u7801\u6587\u4ef6\u4e2d\u8fdb\u884c\u7ec7\u5165. \u8fd9\u79cd\u65b9\u5f0f\u9002\u7528\u4e8e\u9700\u8981\u5728\u7f16\u8bd1\u540e\u7684\u5b57\u8282\u7801\u4e0a\u8fdb\u884c\u5207\u9762\u589e\u5f3a\u7684\u573a\u666f.",(0,r.jsx)("br",{}),(0,r.jsx)(t.strong,{children:"\u52a0\u8f7d\u65f6\u7ec7\u5165"}),"(Load-Time Weaving): \u5728\u7c7b\u52a0\u8f7d\u65f6, \u5c06\u5207\u9762\u4ee3\u7801\u52a8\u6001\u7ec7\u5165\u5230\u76ee\u6807\u7c7b\u7684\u5b57\u8282\u7801\u4e2d. \u8fd9\u901a\u5e38\u9700\u8981\u4e00\u4e2a\u7279\u6b8a\u7684\u7c7b\u52a0\u8f7d\u5668, \u4f7f\u7528 Java \u7684 Instrumentation API \u5b9e\u73b0."]})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.a,{href:"https://github.com/doukai/nozdormu",children:(0,r.jsx)(t.strong,{children:"Nozdormu"})})," \u4f7f\u7528\u6bd4\u52a8\u6001\u4ee3\u7406\u548c\u5b57\u8282\u7801\u589e\u5f3a\u6280\u672f\u66f4\u900f\u660e\u9ad8\u6548\u7684 Annotation Processing(JSR-269) \u6280\u672f, \u901a\u8fc7\u5bf9\u5207\u7247\u4ee3\u7801\u7684\u9759\u6001\u5206\u6790, \u5728\u7f16\u8bd1\u524d\u9636\u6bb5\u5c06\u5207\u9762\u7ec7\u5165\u5230\u6e90\u7801\u4e2d, \u66f4\u6613\u4e8e\u8c03\u8bd5\u7684\u540c\u65f6\u4e5f\u80fd\u5145\u5206\u53d1\u6325\u7f16\u8bd1\u5668\u548c IDE \u7684\u68c0\u67e5\u529f\u80fd"]}),"\n",(0,r.jsx)(t.mermaid,{value:'flowchart TB\n    java["public class Satellite {\n    &emsp;@Launch;\n    &emsp;public String startup(String name) {\n    &emsp;&emsp;// ...;\n    &emsp;}\n    }"]\n    interceptor1["@Interceptor\n    @Launch\n    @Priority(0)\n    public class FirstLaunchInterceptor {\n    &emsp;@AroundInvoke\n    &emsp;public Object aroundInvoke(InvocationContext invocationContext) {\n    &emsp;// ...\n    &emsp;};\n    }"]\n    interceptor2["@Interceptor\n    @Launch\n    @Priority(1)\n    public class SecondLaunchInterceptor {\n    &emsp;@AroundInvoke\n    &emsp;public Object aroundInvoke(InvocationContext invocationContext) {\n    &emsp;// ...\n    &emsp;};\n    }"]\n    proxy["public class Satellite_Proxy extends Satellite {\n    &emsp;@Override();\n    &emsp;public String startup(String name) {\n    &emsp;&emsp;InvocationContext secondContext = new InvocationContextProxy();\n    &emsp;&emsp;InvocationContext firstContext = new InvocationContextProxy().setNextProceed(BeanContext.get(SecondLaunchInterceptor.class)::aroundInvoke).setNextInvocationContext(secondContext);\n    &emsp;&emsp;return (String) BeanContext.get(FirstLaunchInterceptor.class).aroundInvoke(firstContext);\n    &emsp;}\n    }"]\n    java & interceptor1 & interceptor2 --\x3e \u4ee3\u7801\u5206\u6790 --\x3e JSR-269 --\x3e proxy\n\n    style java text-align:left\n    style interceptor1 text-align:left\n    style interceptor2 text-align:left\n    style proxy text-align:left'}),"\n",(0,r.jsx)(t.h2,{id:"\u5b89\u88c5",children:"\u5b89\u88c5"}),"\n",(0,r.jsx)(t.p,{children:"\u6dfb\u52a0\u4f9d\u8d56"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-gradle",children:"repositories {\n    mavenCentral()\n    // highlight-start\n    jcenter()\n    // highlight-end\n}\n\ndependencies {\n    implementation 'io.nozdormu:nozdormu-inject:0.0.1-SNAPSHOT'\n    // highlight-start\n    implementation 'io.nozdormu:nozdormu-interceptor:0.0.1-SNAPSHOT'\n    // highlight-end\n\n    annotationProcessor 'io.nozdormu:nozdormu-inject:0.0.1-SNAPSHOT'\n    // highlight-start\n    annotationProcessor 'io.nozdormu:nozdormu-interceptor:0.0.1-SNAPSHOT'\n    // highlight-end\n}\n"})}),"\n",(0,r.jsx)(t.h2,{id:"\u65b9\u6cd5\u5207\u9762",children:"\u65b9\u6cd5\u5207\u9762"}),"\n",(0,r.jsx)(t.h3,{id:"\u5b9a\u4e49\u65b9\u6cd5\u6ce8\u89e3",children:"\u5b9a\u4e49\u65b9\u6cd5\u6ce8\u89e3"}),"\n",(0,r.jsxs)(t.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@InterceptorBinding"})})," \u6807\u8bb0\u65b9\u6cd5\u6ce8\u89e3"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="Launch.java"',children:'import jakarta.interceptor.InterceptorBinding;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n// highlight-start\n@InterceptorBinding\n// highlight-end\n@Target({ElementType.TYPE, ElementType.METHOD})\n@Retention(value = RetentionPolicy.RUNTIME)\npublic @interface Launch {\n    String value() default "";\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"\u5b9e\u73b0\u65b9\u6cd5\u5207\u9762",children:"\u5b9e\u73b0\u65b9\u6cd5\u5207\u9762"}),"\n",(0,r.jsxs)(t.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@Interceptor"})})," \u548c",(0,r.jsx)(t.a,{href:"#%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95%E6%B3%A8%E8%A7%A3",children:"\u65b9\u6cd5\u6ce8\u89e3"}),"\u6807\u8bb0\u5207\u9762\u7c7b, \u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@AroundInvoke"})}),"\u6307\u5b9a\u5207\u9762\u5b9e\u73b0\u7684\u65b9\u6cd5, \u5982\u679c\u9700\u8981\u6307\u5b9a\u5207\u9762\u65b9\u6cd5\u7684\u6267\u884c\u987a\u5e8f\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@Priority"})})," \u6ce8\u89e3\u6307\u5b9a"]}),"\n",(0,r.jsxs)(t.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E5%88%87%E9%9D%A2-api",children:(0,r.jsx)(t.code,{children:"InvocationContext"})})," \u4e2d\u7684 ",(0,r.jsx)(t.code,{children:"proceed()"})," \u65b9\u6cd5\u53ef\u4ee5\u6267\u884c",(0,r.jsx)(t.a,{href:"#%E6%A0%87%E8%AE%B0%E7%9B%AE%E6%A0%87%E6%96%B9%E6%B3%95",children:"\u76ee\u6807\u65b9\u6cd5"}),"\u5e76\u8fd4\u56de\u7ed3\u679c"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="FirstLaunchInterceptor.java"',children:'import io.nozdormu.interceptor.test.annotation.Launch;\nimport jakarta.annotation.Priority;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.interceptor.AroundInvoke;\nimport jakarta.interceptor.Interceptor;\nimport jakarta.interceptor.InvocationContext;\n\n@ApplicationScoped\n// highlight-start\n@Launch         //\u65b9\u6cd5\n@Priority(0)    //\u987a\u5e8f\u6ce8\u89e3\n@Interceptor    //\u5207\u9762\u6ce8\u89e3\n// highlight-end\npublic class FirstLaunchInterceptor {\n\n    // highlight-start\n    @AroundInvoke\n    // highlight-end\n    public Object aroundInvoke(InvocationContext invocationContext) {\n        try {\n            // highlight-start\n            return "first stage fired -> " + invocationContext.proceed();\n            // highlight-end\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="SecondLaunchInterceptor.java"',children:'import io.nozdormu.interceptor.test.annotation.Launch;\nimport jakarta.annotation.Priority;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.interceptor.AroundInvoke;\nimport jakarta.interceptor.Interceptor;\nimport jakarta.interceptor.InvocationContext;\n\n@ApplicationScoped\n// highlight-start\n@Launch         //\u65b9\u6cd5\u6ce8\u89e3\n@Priority(1)    //\u987a\u5e8f\u6ce8\u89e3\n@Interceptor    //\u5207\u9762\u6ce8\u89e3\n// highlight-end\npublic class SecondLaunchInterceptor {\n\n    // highlight-start\n    @AroundInvoke\n    // highlight-end\n    public Object aroundInvoke(InvocationContext invocationContext) {\n        try {\n            // highlight-start\n            return "second stage fired -> " + invocationContext.proceed();\n            // highlight-end\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"\u6807\u8bb0\u76ee\u6807\u65b9\u6cd5",children:"\u6807\u8bb0\u76ee\u6807\u65b9\u6cd5"}),"\n",(0,r.jsxs)(t.p,{children:["\u5728\u76ee\u6807\u65b9\u6cd5\u4e0a\u4f7f\u7528",(0,r.jsx)(t.a,{href:"#%E5%AE%9A%E4%B9%89%E6%96%B9%E6%B3%95%E6%B3%A8%E8%A7%A3",children:"\u65b9\u6cd5\u6ce8\u89e3"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="Satellite.java"',children:'import io.nozdormu.interceptor.test.annotation.Launch;\nimport jakarta.enterprise.context.ApplicationScoped;\n\n@ApplicationScoped\npublic class Satellite {\n\n    // highlight-start\n    @Launch\n    // highlight-end\n    public String startup(String name) {\n        return "hello " + name + " I am " + owner.getName();\n    }\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u6d4b\u8bd5"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="InterceptorTest.java"',children:'import io.nozdormu.interceptor.test.beans.Satellite;\nimport io.nozdormu.spi.context.BeanContext;\nimport org.junit.jupiter.api.Test;\n\nimport static org.junit.jupiter.api.Assertions.assertEquals;\n\npublic class InterceptorTest {\n\n    @Test\n    void testSatellite() {\n        Satellite satellite = BeanContext.get(Satellite.class);\n        assertEquals(satellite.checkResult(), "first stage ready -> second stage ready -> all check ready, fire");\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"\u6784\u9020\u5668\u5207\u9762",children:"\u6784\u9020\u5668\u5207\u9762"}),"\n",(0,r.jsx)(t.h3,{id:"\u5b9a\u4e49\u6784\u9020\u5668\u6ce8\u89e3",children:"\u5b9a\u4e49\u6784\u9020\u5668\u6ce8\u89e3"}),"\n",(0,r.jsxs)(t.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@InterceptorBinding"})})," \u6807\u8bb0\u6784\u9020\u5668\u6ce8\u89e3"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="Install.java"',children:"import jakarta.interceptor.InterceptorBinding;\n\nimport java.lang.annotation.ElementType;\nimport java.lang.annotation.Retention;\nimport java.lang.annotation.RetentionPolicy;\nimport java.lang.annotation.Target;\n\n// highlight-start\n@InterceptorBinding\n// highlight-end\n@Target({ElementType.TYPE, ElementType.CONSTRUCTOR})\n@Retention(value = RetentionPolicy.RUNTIME)\npublic @interface Install {\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"\u5b9e\u73b0\u6784\u9020\u5668\u5207\u9762",children:"\u5b9e\u73b0\u6784\u9020\u5668\u5207\u9762"}),"\n",(0,r.jsxs)(t.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@Interceptor"})})," \u548c",(0,r.jsx)(t.a,{href:"#%E5%AE%9A%E4%B9%89%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E8%A7%A3",children:"\u6784\u9020\u5668\u6ce8\u89e3"}),"\u6807\u8bb0\u5207\u9762\u7c7b, \u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@AroundConstruct"})})," \u6307\u5b9a\u5207\u9762\u5b9e\u73b0\u7684\u65b9\u6cd5, \u5982\u679c\u9700\u8981\u6307\u5b9a\u5207\u9762\u65b9\u6cd5\u7684\u6267\u884c\u987a\u5e8f\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E6%B3%A8%E8%A7%A3%E8%AF%B4%E6%98%8E",children:(0,r.jsx)(t.code,{children:"@Priority"})})," \u6ce8\u89e3\u6307\u5b9a"]}),"\n",(0,r.jsxs)(t.p,{children:["\u4f7f\u7528 ",(0,r.jsx)(t.a,{href:"#%E5%88%87%E9%9D%A2-api",children:(0,r.jsx)(t.code,{children:"InvocationContext"})})," \u4e2d\u7684 ",(0,r.jsx)(t.code,{children:"proceed()"})," \u65b9\u6cd5\u53ef\u4ee5\u6267\u884c",(0,r.jsx)(t.a,{href:"#%E6%A0%87%E8%AE%B0%E7%9B%AE%E6%A0%87%E6%9E%84%E9%80%A0%E5%99%A8",children:"\u76ee\u6807\u6784\u9020\u5668"}),"\u5e76\u8fd4\u56de\u7ed3\u679c"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="FirstInstallInterceptor.java"',children:'import io.nozdormu.interceptor.test.annotation.Install;\nimport jakarta.annotation.Priority;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.interceptor.AroundConstruct;\nimport jakarta.interceptor.Interceptor;\nimport jakarta.interceptor.InvocationContext;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n@ApplicationScoped\n// highlight-start\n@Launch         //\u6784\u9020\u5668\u6ce8\u89e3\n@Priority(0)    //\u987a\u5e8f\u6ce8\u89e3\n@Interceptor    //\u5207\u9762\u6ce8\u89e3\n// highlight-end\npublic class FirstInstallInterceptor {\n\n    // highlight-start\n    @AroundConstruct\n    // highlight-end\n    public Object aroundConstruct(InvocationContext invocationContext) {\n        List<String> infoList = ((ArrayList<String>) invocationContext.getContextData().computeIfAbsent("infoList", (key) -> new ArrayList<String>()));\n        infoList.add("first stage ready ->");\n        try {\n            // highlight-start\n            return invocationContext.proceed();\n            // highlight-end\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="SecondInstallInterceptor.java"',children:'import io.nozdormu.interceptor.test.annotation.Install;\nimport io.nozdormu.interceptor.test.beans.Satellite;\nimport jakarta.annotation.Priority;\nimport jakarta.enterprise.context.ApplicationScoped;\nimport jakarta.interceptor.AroundConstruct;\nimport jakarta.interceptor.Interceptor;\nimport jakarta.interceptor.InvocationContext;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n@ApplicationScoped\n// highlight-start\n@Launch         //\u6784\u9020\u5668\u6ce8\u89e3\n@Priority(1)    //\u987a\u5e8f\u6ce8\u89e3\n@Interceptor    //\u5207\u9762\u6ce8\u89e3\n// highlight-end\npublic class SecondInstallInterceptor {\n\n    // highlight-start\n    @AroundConstruct\n    // highlight-end\n    public Object aroundConstruct(InvocationContext invocationContext) {\n        List<String> infoList = ((ArrayList<String>) invocationContext.getContextData().computeIfAbsent("infoList", (key) -> new ArrayList<String>()));\n        infoList.add("second stage ready ->");\n        try {\n            // highlight-start\n            Satellite satellite = (Satellite) invocationContext.proceed();\n            // highlight-end\n            satellite.setInfoList(infoList);\n            return satellite;\n        } catch (Exception e) {\n            throw new RuntimeException(e);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"\u6807\u8bb0\u76ee\u6807\u6784\u9020\u5668",children:"\u6807\u8bb0\u76ee\u6807\u6784\u9020\u5668"}),"\n",(0,r.jsxs)(t.p,{children:["\u5728\u76ee\u6807\u65b9\u6cd5\u4e0a\u4f7f\u7528",(0,r.jsx)(t.a,{href:"#%E5%AE%9A%E4%B9%89%E6%9E%84%E9%80%A0%E5%99%A8%E6%B3%A8%E8%A7%A3",children:"\u6784\u9020\u5668\u6ce8\u89e3"})]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="Satellite.java"',children:'import io.nozdormu.interceptor.test.annotation.Install;\nimport jakarta.enterprise.context.ApplicationScoped;\n\nimport java.util.ArrayList;\nimport java.util.List;\n\n@ApplicationScoped\npublic class Satellite {\n\n    private List<String> infoList = new ArrayList<>();\n\n    private final Owner owner;\n\n    // highlight-start\n    @Install\n    // highlight-end\n    public Satellite(Owner owner) {\n        this.owner = owner;\n    }\n\n    public void setInfoList(List<String> infoList) {\n        this.infoList = infoList;\n    }\n\n    public String checkResult() {\n        return String.join(" ", infoList) + " all check ready, fire";\n    }\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"\u6d4b\u8bd5"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-java",metastring:'title="InterceptorTest.java"',children:'import io.nozdormu.interceptor.test.beans.Satellite;\nimport io.nozdormu.spi.context.BeanContext;\nimport org.junit.jupiter.api.Test;\n\nimport static org.junit.jupiter.api.Assertions.assertEquals;\n\npublic class InterceptorTest {\n\n    @Test\n    void testSatellite() {\n        Satellite satellite = BeanContext.get(Satellite.class);\n        assertEquals(satellite.startup("nozdormu"), "first stage fired -> second stage fired -> hello nozdormu I am NASA");\n    }\n}\n'})}),"\n",(0,r.jsx)(t.h2,{id:"\u6ce8\u518c\u5207\u9762",children:"\u6ce8\u518c\u5207\u9762"}),"\n",(0,r.jsxs)(t.p,{children:["\u5728\u4f7f\u7528\u7b2c\u4e09\u65b9\u7c7b\u5e93\u4e2d\u7684\u6ce8\u89e3\u65f6, \u7531\u4e8e\u6ce8\u89e3\u4e2d\u6ca1\u6709 ",(0,r.jsx)(t.code,{children:"@InterceptorBinding"})," \u9700\u8981\u5bf9\u6ce8\u89e3\u8fdb\u884c\u5207\u9762\u6ce8\u518c"]}),"\n",(0,r.jsxs)(t.p,{children:["\u5728 ",(0,r.jsx)(t.code,{children:"META-INF/interceptor"})," \u76ee\u5f55\u4e0b\u4ee5\u6ce8\u89e3\u540d\u4e3a\u6587\u4ef6\u540d, \u6587\u4ef6\u4e2d\u7684\u6bcf\u4e00\u884c\u4ee3\u8868\u4e00\u4e2a\u8be5\u6ce8\u89e3\u7684\u5b9e\u73b0\u7c7b"]}),"\n",(0,r.jsx)(t.p,{children:"\u4f8b:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"|-- your-project\n    |-- build.gradle\n    |-- src\n        |-- main\n            |-- java\n            |   |-- your.package\n            |       |-- xxx.java\n            |-- resources\n                |-- META-INF\n                    |-- interceptor                                         \u6ce8\u518c\u76ee\u5f55\n                        |-- io.nozdormu.interceptor.test.annotation.Launch  \u4ee5\u6ce8\u89e3\u540d\u4f5c\u4e3a\u6587\u4ef6\u540d\n"})}),"\n",(0,r.jsx)(t.p,{children:"\u5c06\u6240\u6709\u5207\u9762\u5b9e\u73b0\u7684\u7c7b\u540d\u9010\u884c\u6ce8\u518c"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-txt",metastring:'title="io.nozdormu.interceptor.test.annotation.Launch"',children:"io.nozdormu.interceptor.test.interceptor.FirstLaunchInterceptor\nio.nozdormu.interceptor.test.interceptor.SecondLaunchInterceptor\n"})}),"\n",(0,r.jsx)(t.h2,{id:"\u5207\u9762-api",children:(0,r.jsx)(t.strong,{children:"\u5207\u9762 API"})}),"\n",(0,r.jsx)(t.h3,{id:"invocationcontext",children:"InvocationContext"}),"\n",(0,r.jsx)(t.p,{children:"\u4f7f\u7528 InvocationContext \u83b7\u5f97\u5207\u9762\u8fd0\u884c\u65f6\u7684\u53c2\u6570\u548c\u65b9\u6cd5"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u6ce8\u89e3"}),(0,r.jsx)(t.th,{children:"\u53c2\u6570"}),(0,r.jsx)(t.th,{children:"\u8fd4\u56de\u503c"}),(0,r.jsx)(t.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Object getTarget()"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"Object"}),(0,r.jsx)(t.td,{children:"\u8fd4\u56de\u76ee\u6807\u5b9e\u4f8b"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Method getMethod()"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"Method"}),(0,r.jsx)(t.td,{children:"\u8fd4\u56de\u8c03\u7528\u62e6\u622a\u5668\u7684\u76ee\u6807\u7c7b\u7684\u65b9\u6cd5"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Constructor<?> getConstructor()"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"Constructor<?>"}),(0,r.jsx)(t.td,{children:"\u8fd4\u56de\u8c03\u7528\u62e6\u622a\u5668\u65b9\u6cd5\u7684\u76ee\u6807\u7c7b\u7684\u6784\u9020\u51fd\u6570"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Object[] getParameters()"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"Object[]"}),(0,r.jsx)(t.td,{children:"\u8fd4\u56de\u5c06\u4f20\u9012\u7ed9\u76ee\u6807\u7c7b\u7684\u65b9\u6cd5\u6216\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u503c"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"void setParameters(Object[] params)"}),(0,r.jsx)(t.td,{children:"\u53c2\u6570\u503c"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"\u8bbe\u7f6e\u5c06\u4f20\u9012\u7ed9\u76ee\u6807\u7c7b\u7684\u65b9\u6cd5\u6216\u6784\u9020\u51fd\u6570\u7684\u53c2\u6570\u503c"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Map<String, Object> getContextData()"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"Map<String, Object>"}),(0,r.jsx)(t.td,{children:"\u4e0e\u6b64\u8c03\u7528\u6216\u751f\u547d\u5468\u671f\u56de\u8c03\u76f8\u5173\u7684\u4e0a\u4e0b\u6587\u6570\u636e"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"Object proceed() throws Exception"}),(0,r.jsx)(t.td,{children:"\u65e0"}),(0,r.jsx)(t.td,{children:"Object"}),(0,r.jsx)(t.td,{children:"\u7ee7\u7eed\u6267\u884c\u62e6\u622a\u5668\u94fe\u4e2d\u7684\u4e0b\u4e00\u4e2a\u62e6\u622a\u5668"})]})]})]}),"\n",(0,r.jsx)(t.h2,{id:"\u6ce8\u89e3\u8bf4\u660e",children:(0,r.jsx)(t.strong,{children:"\u6ce8\u89e3\u8bf4\u660e"})}),"\n",(0,r.jsx)(t.h3,{id:"interceptor",children:"Interceptor"}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"\u6ce8\u89e3"}),(0,r.jsx)(t.th,{children:"\u76ee\u6807"}),(0,r.jsx)(t.th,{children:"\u8bf4\u660e"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"jakarta.interceptor.InterceptorBinding"}),(0,r.jsx)(t.td,{children:"\u6ce8\u89e3"}),(0,r.jsx)(t.td,{children:"\u6807\u8bb0\u9700\u8981\u5207\u9762\u5904\u7406\u7684\u6ce8\u89e3"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"jakarta.interceptor.Interceptor"}),(0,r.jsx)(t.td,{children:"\u7c7b"}),(0,r.jsx)(t.td,{children:"\u6807\u8bb0\u5207\u9762\u7684\u5b9e\u73b0\u7c7b"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"jakarta.interceptor.AroundInvoke"}),(0,r.jsx)(t.td,{children:"\u65b9\u6cd5"}),(0,r.jsx)(t.td,{children:"\u6807\u8bb0\u65b9\u6cd5\u5207\u9762\u7684\u5b9e\u73b0\u65b9\u6cd5"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"jakarta.interceptor.AroundConstruct"}),(0,r.jsx)(t.td,{children:"\u65b9\u6cd5"}),(0,r.jsx)(t.td,{children:"\u6807\u8bb0\u6784\u9020\u5668\u5207\u9762\u7684\u5b9e\u73b0\u65b9\u6cd5"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:"jakarta.annotation.Priority"}),(0,r.jsx)(t.td,{children:"\u7c7b"}),(0,r.jsx)(t.td,{children:"\u914d\u7f6e\u5207\u9762\u7684\u6267\u884c\u987a\u5e8f"})]})]})]})]})}function h(n={}){const{wrapper:t}={...(0,i.R)(),...n.components};return t?(0,r.jsx)(t,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},5710:(n,t,e)=>{e.d(t,{R:()=>a,x:()=>c});var r=e(758);const i={},o=r.createContext(i);function a(n){const t=r.useContext(o);return r.useMemo((function(){return"function"==typeof n?n(t):{...t,...n}}),[t,n])}function c(n){let t;return t=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:a(n.components),r.createElement(o.Provider,{value:t},n.children)}}}]);